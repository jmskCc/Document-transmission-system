# 公文传输系统安全性设计报告

组名：超级高水平小队

小组成员：李昂、张振、贾萱、高雨辰、王曜人、刘治言、骆涧淞

## 1、密码方案的应用

国密算法是指国家密码局确定的国产密码算法 。通 常 包 括 SM1 ，SM2 ， SM3 ， SM4 等国密密码算法 。密钥长度与分组长度均为 128 位 。

SM1 ：对称加密算法 ， 其加密强度和AES相 当 。 此算法不公开 ，调用该算法时 ，需要通过加密IC芯片的接口进行加密算法调用 。

SM2 ：非对称加密算法 ， 基 于 ECC ， 此 算 法 已 公 开 。因 为 此 算 法 基 于 ECC ， 所以其签名速度和秘钥生成速度远 远 快 于 RSA 商 密 算 法 。 ECC 256 位 （SM2 使 用 的 是ECC256 位 的 一 种 ） 其 安 全 强 度 比 RSA 2048 位 算 法 高 ， 同 时运算速度远远快于快于 RSA 商 密 算 法 。

SM3 ：消息摘要 ，可以用MD5对比理解校验 ，此算法已公开 ， 校验结果是256位 。

SM4 ：无线局域网标准的分组 数据加密算法 ， 对称加 密 ， 密钥长度与分组长度都是 128 位 。

此次电子公文传输系统加密采取 SM2 算法 ，就SM2 算 法 来 说 ， 通过数字信封实现数据的安全保护 ， 采用对称加密算法 SMS4 加 密 数 据 ， 采用椭圆曲线算法SM2 加 密 之 前 SMS4 加密时用到的密钥 。国家密码管理局发布《 SM2 密码算法使用规范 》 若 GIS项目中日后 使用 到 SM2 接 口 ， 需 符 合 该 规 范 。

SM2 算 法 推 荐 使 用 256 位 素 域 GF ( P ) 上的椭圆曲线 ： 参 数 h = 1 。 密 钥 长 度 为 256 比 特 ， 采 用 ECB 电 码 本模 式 ， 私 钥 key 需 满 足 , 公钥是椭圆曲线上的一个点 ，SM2 有规定好的密钥分配协议 page33 ， SM2 算 法 使 用到 的 HASH 值 均 由SM3 算 法 计 算 得 到 。 具 体 的 模 块 设

计 如 下 所 示 ： 

1 ） 加 密

SM2 算 法 基 于 ECC 椭圆曲线密码加密 算法机制 ，区 别 在 于 签 名 、 密钥交换方式与 ECDSA 、 ECDH 等 国 际算 法 标 准 不 同 ， 使用和采取了更为安 全的加密算法机制 。 同 时 ， SM2 使 用 了 一 条 256 位 的 ECC 曲 线 作 为 标 准曲 线 。 SM2 国密算法标准包括总则法 、 密 钥 交 换 协 议 、数 字 签 名 算 法 、 公钥加密算法四个部分组成 。 

![image-20210615100302440](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\image-20210615100302440.png)

2 ） 解 密

（ 1 ） 从 密 文 比 特 串 C = C1‖ C2‖ C3 中 取 出 C1 ， 将 C1

转换成椭圆曲线上的点 。 

（ 2 ） 验 证 C1 ， 计 算 S = [ h ] C1 ， 如 果 S 是 无 穷 远 点 ， 出

错 退 出 。 

（ 3 ） 计 算 ( x2 , y2 ) = [ dB ] C1 。 

（ 4 ） 计 算 t = KDF ( x2‖ y2 , klen ) , KDF 是 密 钥 派 生 函

数 ， 如 果 t 是 全 0 比 特 串 ， 出 错 退 出 。 

（ 5 ） 从 C = C1‖C2‖C3 中 取 出 C2 ， 计 算 M＇ = C2+ t 。 

（ 6 ） 计 算 u = Hash ( x2‖M＇‖y2 ) ， 比 较 u 是 否 与 C3 相 等 ， 不 相 等 则 退 出 。

（ 7 ） 输 出 明 文 M＇ 。

![image-20210615100419132](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\image-20210615100419132.png)

![image-20210615100452796](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\image-20210615100452796.png)

## 2、要求实现

### 2.1密码功能要求

首先，是需要达到的密码功能要求。
机密性使用密码加密功能实现机密性，本小组信息系统中保护的对象为∶ 
1.传输的重要数据、敏感信息数据或整个报文; 
2.存储的重要数据和敏感信息数据; 
3.身份鉴别信息; 
4.密钥数据。
完整性使用消息鉴别码（MAC）或数字签名实现完整性，本小组信息系统中保护的对象为∶ 
1.传输的重要数据、敏感信息数据或整个报文;
2.存储的重要数据、文件和敏感信息数据;
3.身份鉴别信息; 
4.密钥数据; 
5.日志记录; 
6.重要程序。
真实性使用对称加密、动态口令、数字签名等实现真实性，本小组信息系统应用场景为∶
1.通信双方的身份鉴别; 
2.登录操作系统和数据库系统的用户身份鉴别; 
3.应用系统的用户身份鉴别。
不可否认性使用数字签名等密码技术实现实体行为的不可否认性，针对在本小组信息系统中所有需要无法否认的行为，包括发送、接收、审批、创建、修改、删除、添加、配置等操作。

### 2.2网络和通信安全

其次是网络和通信安全需求。
采用密码技术对连接到内部网络的设备进行安全认证，并且使用密码技术对通信的双方身份进行认证，同时保证通信过程中数据的完整性以及敏感信息数据字段或整个报文的机密性。
本小组信息系统等级保护可达到《GMT+0054-2018信息系统密码应用基本要求》所定义一级。

## 3、具体应用

### 3.1身份认证

在通信前基于密码技术进行身份认证。采用密码技术对登录的用户进行身份鉴别。可使用密码技术对登录的用户进行身份标识和鉴别，身份标识具有唯一性，身份鉴别信息具有 复杂度要求并定期更换，使用密码技术的真实性功能来实现鉴别信息的防假冒。

### 3.2真实性

保证传输过程中鉴别信息的机密性和网络设备实体身份的真实性。

### 3.3 完整性

#### 3.3.1 网络边界和系统资源访问控制信息的完整性

可使用密码技术的完整性功能来保证网络边界和系统资源访问控制信息的完整性。

#### 3.3.2 通信过程中数据的完整性

可采用密码技术保证通信过程中数据的完整性。

#### 3.3.3 重要信息资源敏感标记的完整性

采用密码技术的完整性功能来保证重要信息资源敏感标记的完整性。

#### 3.3.4 文件的完整性保护

采用密码技术的完整性功能对重要程序或文件进行完整性保护。

### 3.4 机密性

可采用密码技术保证通信过程中敏感信息数据字段或整个报文的机密性。

## 4、信息安全技术 信息系统密码应用基本要求

### 4.1信息系统密码应用技术框架

#### 4.1.1框架概述

本组公文传输系统从信息系统的物理和环境安全、网络和通信安全、设备和计算安全、应用和数据安全四个层 面提出密码应用技术要求，保障信息系统的实体身份真实性、重要数据的机密性和完整性、操作行为的 不可否认性；并从信息系统的管理制度人员管理、建设运行、应急处置等四个方面提出密码应用管理要求，为信息系统提供管理方面的密码应用安全保障。

#### 4.1.2密码应用技术要求维度

技术要求主要由机密性、完整性、真实性、不可否认性四个密码安全功能维度构成，具体保护对象或 应用场景描述如下：
a）	机密性技术要求保护对象
使用密码技术的加解密功能实现机密性，信息系统中保护的对象为：
1）	身份鉴别信息；
2）	密钥数据；
3）	传输的重要数据；
4）	信息系统应用中所有存储的重要数据。
b）	完整性技术要求保护对象
使用基于对称密码算法或密码杂凑算法的消息鉴别码机制、基于公钥密码算法的数字签名机 制等密码技术实现完整性,信息系统中保护的对象为：
1）	身份鉴别信息；
2）	密钥数据；
3）	日志记录；
4）	访问控制信息；
5）	重要信息资源安全标记；
6）	传输的重要数据；
7）	信息系统应用中所有存储的重要数据。
c） 真实性技术要求应用场景
使用动态口令机制、基于对称密码算法或密码杂凑算法的消息鉴别码机制、基于公钥密码算法 的数字签名机制等密码技术实现真实性，信息系统中应用场景为：
1）	通信双方的身份鉴别；
2）	登录操作系统和数据库系统的用户身份鉴别；
3）	应用系统的用户身份鉴别。
d）不可否认性技术要求保护对象
使用基于公钥密码算法的数字签名机制等密码技术来保证数据原发行为的不可否认性和数据 接收行为的不可否认性。

#### 4.1.3 密码应用管理要求维度

管理要求由管理制度、人员管理、建设运行、应急处置等四个密码应用管理维度构成，具体如下：
a）	密码应用安全管理相关流程制度的制定、发布、修订的规范性要求；
b）	密码相关安全人员的密码安全意识以及关键密码安全岗位员工的密码安全能力的培养，人员 工作流程要求等；
c）	建设运行过程中密码应用安全要求及方案落地执行的一致性和有效性要求；
d）	处理密码应用安全相关的应急突发事件的能力要求。

### 4.2密码应用基本要求等级描述

参照GB/T 22239的等级保护对象应具备的基本安全保护能力要求，该标准提岀密码保障能力逐级增强的要求，用一、二、三、四、五表示。本组电子公文传输系统按照我们的实际情况选择相应级别的密码保障技术能力及管理能力。
通用要求
第一级到第五级的信息系统应符合以下通用要求：
a）	信息系统中使用的密码算法应符合法律、法规的规定和密码相关国家标准、行业标准的有关 要求；
b）	信息系统中使用的密码技术应遵循密码相关国家标准和行业标准；
c）	信息系统中使用的密码产品、密码服务应符合法律法规的相关要求。

#### 4.2.1网络和通信安全

本级要求包括：
a）	可采用密码技术对通信实体进行身份鉴别，保证通信实体身份的真实性；
b）	可釆用密码技术保证通信过程中数据的完整性；
c）	可采用密码技术保证通信过程中重要数据的机密性；
d）	可釆用密码技术保证网络边界访问控制信息的完整性；

#### 4.2.2设备和计算安全

本级要求包括：
a）	可采用密码技术对登录设备的用户进行身份鉴别，保证用户身份的真实性；
b）	可采用密码技术保证系统资源访问控制信息的完整性；
c）	可采用密码技术保证日志记录的完整性；

#### 4.2.3应用和数据安全

本级要求包括：
a）	可采用密码技术对登录用户进行身份鉴别，保证应用系统用户身份的真实性；
b）	可采用密码技术保证信息系统应用的访问控制信息的完整性；
c）	可采用密码技术保证信息系统应用的重要数据在传输过程中的机密性；
d）	可采用密码技术保证信息系统应用的重要数据在存储过程中的机密性；
e）	可采用密码技术保证信息系统应用的重要数据在传输过程中的完整性；
f）	可采用密码技术保证信息系统应用的重要数据在存储过程中的完整性。

## 5、系统资源分析及定位

用JSP开发系统管理系统基于B/S模式，系统软件和数据集中存放于服务器中，软件的安装与升级在服务器上进行。所有的工作基于浏览器，安装、使用、维护、升级十分简单。

为了保证系统能够长期、安全、稳定、可靠、高效的运行。系统处理的准确性和及时性是系统的必要性能。由于本系统的添加功能对于整个系统的功能和性能完成举足轻重。作为系统的很多数据来源，其准确性和及时性很大程度上决定了系统的成败。在系统开发过程中，必须采用一定的方法保证系统的准确性和及时性。

硬件系统环境：C600、1G MB（RAM）、500MB（HD）。系统运行时对数据的保密性要求不高对一般的数据不要求进行加密。此外，对其它软件几乎没有依赖性，程序健壮性较好。

硬件条件：酷睿2 CPU、1G RAM、10 G硬盘以上的PC机。

软件条件：Windows XP 

JSP(JSPServer Pages)是由Sun Microsystems公司倡导、许多公司参与一起建立的一种动态网页技术标准。它是在传统的网页HTML文件(.htm,.html)中插入JSP程序段(Scriptlet)和JSP标记(tag)，从而形成JSP文件(*.jsp)。 用JSP开发的Web应用是跨平台的，即能在Linux下运行，也能在其他操作系统上运行。JSP技术使用JSP编程语言编写类XML的tags和scriptlets，来封装产生动态网页的处理逻辑。网页还能通过tags和scriptlets访问存在于服务端的资源的应用逻辑。JSP将网页逻辑与网页设计和显示分离，支持可重用的基于组件的设计，使基于Web的应用程序的开发变得迅速和容易。 Web服务器在遇到访问JSP网页的请求时，首先执行其中的程序段，然后将执行结果连同JSP文件中的HTML代码一起返回给客户。插入的JSP程序段可以操作数据库、重新定向网页等，以实现建立动态网页所需要的功能。 JSP与JSP Servlet一样，是在服务器端执行的，通常返回该客户端的就是一个HTML文本，因此客户端只要有浏览器就能浏览。

JSP主要优先如下：

（1）一次编写，到处运行。在这一点上JSP比PHP更出色，除了系统之外，代码不用做任何更改。

（2）系统的多平台支持。基本上可以在所有平台上的任意环境中开发，在任意环境中进行系统部署，在任意环境中扩展。相比JSP/PHP的局限性是显而易见的。 

（3）强大的可伸缩性。从只有一个小的Jar文件就可以运行Servlet/JSP，到由多台服务器进行集群和负载均衡，到多台Application进行事务处理，消息处理，一台服务器到无数台服务器，JSP显示了一个巨大的生命力。 

（4）多样化和功能强大的开发工具支持。这一点与JSP很像，JSP已经有了许多非常优秀的开发工具，而且许多可以免费得到，并且其中许多已经可以顺利的运行于多种平台之下。

## 系统资源定位分析方法

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200416165808482.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaWR1XzI0NzUyMTM1,size_16,color_FFFFFF,t_70#pic_center)

## 内存定位分析

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200416165031288.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaWR1XzI0NzUyMTM1,size_16,color_FFFFFF,t_70#pic_center)

## 磁盘IO定位分析

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200416165052900.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaWR1XzI0NzUyMTM1,size_16,color_FFFFFF,t_70#pic_center)

## 网络定位分析

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200416165114353.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaWR1XzI0NzUyMTM1,size_16,color_FFFFFF,t_70#pic_center)

在我们的电子公文系统中：

SQLServer性能计数器：

Access Methods(访问方法) 用于监视访问数据库中的逻辑页的方法。. Full Scans/sec(全表扫描/秒) 每秒不受限的完全扫描数。可以是基本表扫描或全索引扫描。如果这个计数器显示的值比1或2高，应该分析你的查询以确定是否确实需要全表扫描，以及S Q L查询是否可以被优化。


. Page splits/sec(页分割/秒)由于数据更新操作引起的每秒页分割的数量。

Buffer Manager(缓冲器管理器)：监视 Microsoft&reg; SQLServer™ 如何使用： 内存存储数据页、内部数据结构和过程高速缓存；计数器在 SQL Server从磁盘读取数据库页和将数据库页写入磁盘时监视物理 I/O。 监视 SQL Server 所使用的内存和计数器有助于确定： 是否由于缺少可用物理内存存储高速缓存中经常访问的数据而导致瓶颈存在。如果是这样，SQL Server必须从磁盘检索数据。 是否可通过添加更多内存或使更多内存可用于数据高速缓存或 SQL Server内部结构来提高查询性能。

SQL Server 需要从磁盘读取数据的频率。与其它操作相比，例如内存访问，物理 I/O 会耗费大量时间。尽可能减少物理 I/O 可以提高查询性能。 

.Page Reads/sec：每秒发出的物理数据库页读取数。这一统计信息显示的是在所有数据库间的物理页读取总数。由于物理 I/O的开销大，可以通过使用更大的数据高速缓存、智能索引、更高效的查询或者改变数据库设计等方法，使开销减到最小。

.Page Writes/sec (.写的页/秒)每秒执行的物理数据库写的页数。

.Buffer Cache Hit Ratio. 在“缓冲池”（Buffer Cache/Buffer Pool）中没有被读过的页占整个缓冲池中所有页的比率。可在高速缓存中找到而不需要从磁盘中读取的页的百分比。这一比率是高速缓存命中总数除以自 SQL Server 实例启动后对高速缓存的查找总数。经过很长时间后，这一比率的变化很小。由于从高速缓存中读数据比从磁盘中读数据的开销要小得多，一般希望这一数值高一些。通常，可以通过增加 SQL Server 可用的内存数量来提高高速缓存命中率。计数器值依应用程序而定，但比率最好为90%或更高。增加内存直到这一数值持续高于90%，表示90% 以上的数据请求可以从数据缓冲区中获得所需数据。

. Lazy Writes/sec(惰性写/秒)惰性写进程每秒写的缓冲区的数量。

Cache Manager(高速缓存管理器)对象提供计数器，用于监视 Microsoft&reg; SQL Server™ 如何使用内存存储对象，如存储过程、特殊和准备好的 Transact-SQL 语句以及触发器。

. Cache Hit Ratio(高速缓存命中率，所有Cache”的命中率。在SQLServer中，Cache可以包括LogCache，Buffer Cache以及ProcedureCache，是一个总体的比率。) 高速缓存命中次数和查找次数的比率。对于查看SQL Server高速缓存对于你的系统如何有效，这是一个非常好的计数器。如果这个值很低，持续低于80%，就需要增加更多的内存。


Latches(闩) 用于监视称为闩锁的内部 SQL Server 资源锁。监视闩锁以明确用户活动和资源使用情况，有助于查明性能瓶颈。

. Average Latch Wait Ti m e ( m s ) (平均闩等待时间(毫秒))一个SQL Server线程必须等待一个闩的平均时间，以毫秒为单位。如果这个值很高，你可能正经历严重的竞争问题。

. Latch Waits/sec (闩等待/秒)在闩上每秒的等待数量。如果这个值很高，表明你正经历对资源的大量竞争。

Locks(锁) 提供有关个别资源类型上的 SQL Server 锁的信息。锁加在 SQL Server 资源上（如在一个事务中进行的行读取或修改），以防止多个事务并发使用资源。例如，如果一个排它 (X) 锁被一个事务加在某一表的某一行上，在这个锁被释放前，其它事务都不可以修改这一行。尽可能少使用锁可提高并发性，从而改善性能。可以同时监视 Locks 对象的多个实例，每个实例代表一个资源类型上的一个锁。

. Number ofDeadlocks/sec(死锁的数量/秒) 导致死锁的锁请求的数量

. Average WaitTime(ms) (平均等待时间(毫秒)) 线程等待某种类型的锁的平均等待时间

. LockRequests/sec(锁请求/秒) 每秒钟某种类型的锁请求的数量。

Memory manager:用于监视总体的服务器内存使用情况，以估计用户活动和资源使用，有助于查明性能瓶颈。监视 SQL Server 实例所使用的内存有助于确定： 是否由于缺少可用物理内存存储高速缓存中经常访问的数据而导致瓶颈存在。如果是这样，SQL Server必须从磁盘检索数据。 是否可以通过添加更多内存或使更多内存可用于数据高速缓存或 SQL Server内部结构来提高查询性能。Lock blocks:服务器上锁定块的数量，锁是在页、行或者表这样的资源上。不希望看到一个增长的值。Total server memory：sql server服务器当前正在使用的动态内存总量.

CPU问题
a)        考虑使用更高级的CPU代替目前的CPU
b)       对于多个CPU，考虑CPU之间的负载分配
c)       考虑在其他体系上设计系统，例如增加前置机、设置并行服务器等

内存和高速缓存
a)      内存的优化包括操作系统、数据库、应用程序的内存优化
b)     过多的分页与交换可能降低系统的性能
c)     内存分配也是影响系统性能的主要原因
d)     保证保留列表具有较大的邻接内存块
e)      调整数据块缓存区大小（用数据块的个数表示）是一个重要内容
f)      将最频繁使用的数据保存在存储区中

磁盘（I/O）资源问题
a)      磁盘读写进度对数据库系统是至关重要的，数据库对象在物理设备上的合理分布能改善性能
b)     磁盘镜像会减慢磁盘写的速度
c)     通过把日志和数据库对象分布在独立的设备上，可以提高系统的性能
d)     把不同的数据库放在不同的硬盘上，可以提高读写速度。建议把数据库、回滚段、日志放在不同的设备上
e)      把表放在一块硬盘上，把非簇的索引放在另一块硬盘上，保证物理读写更快。

调整配置参数
a)      包括操作系统和数据库的参数配置
b)     并行操作资源限制的参数（并发用户的数目、会话数）
c)     影响资源开销的参数
d)     与I/O有关的参数

优化应用系统网络设置
a)        可以通过数组接口来减少网络呼叫。不是一次提取一行，而是在单个往来往返中提取10行，这样效率较高
b)       调整会话数据单元的缓冲区大小
c)       共享服务进程比专用服务进程提供更好的性能

**1. TPS小 RT小 资源利用率低**

1.1 RT小，说明性能没有发挥出来

1.2 负载不够（压力机的问题？脚本的问题？用户数的问题？）

1.3 负载是否受限（中间件配置、连数的限制）



**2. TPS小 RT大 资源利用率低**

2.1 脚本是否有问题（事务包含了太多的东西，场景设置的是否合理）

2.2 系统资源没有用上（JVM的配置）

2.3 性能问题，走正常排察流程（CPU等待、线程死锁等）

2.4 负载没有到位（负载机压力过大，压力发不出去）



**3. TPS小 RT大 资源利用率高**

正常情况，排察问题



**4. TPS大 RT小 资源利用率低**

4.1 性能非常优秀的表现

4.2 脚本失败率过高、脚本空跑等



**5. TPS大 RT大 资源利用率低**

不存在



**6.TPS大 RT大 资源利用率高**

不存在



**7. TPS大 RT小 资源利用率高**

如果 资源利用 不超警界线，可以认为测试 通过



**8. TPS小 RT小 资源利用率高**

不存在的

## 总结：

政府工作的全面信息化，离不开公文的电子化。电子公文贯穿于电子政务模式下行政管理的全过程，是关系到电子政务成败的关键，是实现政务公开、提高效率、科学决策、改进和完善服务职能的重要手段。 本文从电子公文产生的背景入手，介绍了电子公文在电子政务环境下的特性。对电子公文传输系统的功能需求、关键技术以及安全性进行了深入研究和分析，本文重点对电子公文系统中的传输子系统作了详细的需求分析和系统结构设计，该设计全面考虑了电子公文在传输过程以及收发文过程的机密性、完整性、真实性以及不可否认性等特性，提出保障系统的机密性、完整性、真实性及不可否认性的解决方案。完成了电子政务环境中的电子公文传输系统中的本地数据库、电子公文传输系统安全应用接口、文件发送接收时的加密、签名，解密、签名认证系统进行了详细设计及具体实现。此外，对用户证书交换、密钥管理、红头文件及印章处理、文件引入、数据压缩等关键技术提出了可行的解决方案。 该项研究目前已应用在一些政府部门中，取得了较为满意的结果，对推动电子政务的全面建设具有一定的积极作用 